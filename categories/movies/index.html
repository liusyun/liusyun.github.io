
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOVIES | 分区文章</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
<link rel="stylesheet" href="/css/category.css">

    <style>
        #global-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
        theme-button { position: fixed; top: 5%; right: 10%; z-index: 2000; }
    </style>
<meta name="generator" content="Hexo 8.1.1"></head>
<body class="preload">
    
    <script>
        (function() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('night-mode');
            }
        })();
    </script>

    <canvas id="global-canvas"></canvas>
    
    <a href="/" class="back-btn"><i class="fa-solid fa-arrow-left"></i> BACK HOME</a>
    
    <theme-button id="btn" size="1"></theme-button>
    <script>
        (function() {
            const btn = document.getElementById('btn');
            const savedTheme = localStorage.getItem('theme');
            if (btn && savedTheme) {
                btn.setAttribute('value', savedTheme);
            }
        })();
    </script>

    <header class="hero-section">
        <div class="hero-bg" id="hero-bg" style="background-image: url('/images/movies.jpg')"></div>
        <div class="hero-content">
            <h1 class="hero-title" id="category-title">MOVIES</h1>
            <p class="hero-subtitle" id="category-subtitle">光影交错的梦境</p>
        </div>
    </header>

    <main class="container">
        <div class="category-layout">
            <div class="post-list" id="post-list-container">
                
                    
                        
                        <a href="/2025/12/05/%E9%93%B6%E7%BF%BC%E6%9D%80%E6%89%8B2049/" class="post-card" data-tags="cyberpunk,科幻" style="animation-delay: 0s">
                            <img src="/images/银翼杀手2049-cover.jpg" alt="you are real for me —— 银翼杀手2049简评" class="post-img">
                            <div class="post-content">
                                <div class="post-meta">
                                    <i class="fa-regular fa-calendar"></i> 2025-12-05 ·
                                    <span class="tag-label">#MOVIES</span>
                                </div>
                                <h2 class="post-title">you are real for me —— 银翼杀手2049简评</h2>
                                <p class="post-excerpt">...</p>
                                <div class="post-footer-tags">
                                    
                                        
                                            <span class="mini-tag">#cyberpunk</span>
                                        
                                            <span class="mini-tag">#科幻</span>
                                        
                                    
                                </div>
                            </div>
                        </a>
                    
                
                <div id="no-result" style="display:none; text-align:center; padding:40px; color:#aaa;">没有找到相关文章...</div>
            </div>

            <aside class="sidebar-filter">
                <div class="filter-card">
                    <h3 class="filter-title"><i class="fa-solid fa-filter"></i> 关键词检索</h3>
                    <p class="filter-desc">Filter by keywords</p>
                    <div class="filter-tags">
                        <button class="filter-btn active" data-filter="all">ALL</button>
                        
                            <button class="filter-btn" data-filter="cyberpunk">
                                cyberpunk <span class="count">1</span>
                            </button>
                        
                            <button class="filter-btn" data-filter="科幻">
                                科幻 <span class="count">1</span>
                            </button>
                        
                    </div>
                </div>
            </aside>
        </div>
    </main>

    <script src="/js/button.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const filterBtns = document.querySelectorAll('.filter-btn');
        const posts = document.querySelectorAll('.post-card');
        const noResultMsg = document.getElementById('no-result');
        const body = document.body;
        const btn = document.getElementById("btn");
        const canvas = document.getElementById('global-canvas');
        const ctx = canvas ? canvas.getContext('2d') : null;
        let animationId; let particles = [];

        // === 动画逻辑 ===
        if (canvas && ctx) {
            function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
            window.addEventListener('resize', resizeCanvas); resizeCanvas();

            class Sakura { constructor(){ this.x = Math.random() * canvas.width; this.y = Math.random() * canvas.height; this.size = Math.random() * 8 + 6; this.speedX = Math.random() * 1 - 0.5; this.speedY = Math.random() * 1.5 + 1; this.rotation = Math.random() * 360; this.rotationSpeed = Math.random() * 2 - 1; this.color = ['#fff', '#ffe6e9', '#ffccd5'][Math.floor(Math.random() * 3)]; } update() { this.x += this.speedX; this.y += this.speedY; this.rotation += this.rotationSpeed; if(this.y > canvas.height){ this.y = -10; this.x = Math.random() * canvas.width; }} draw() { ctx.save(); ctx.translate(this.x, this.y); ctx.rotate(this.rotation * Math.PI / 180); ctx.fillStyle = this.color; ctx.beginPath(); ctx.moveTo(0,0); ctx.bezierCurveTo(this.size/2, -this.size/2, this.size, -this.size/2, 0, this.size); ctx.fill(); ctx.restore(); } }
            class Firefly { constructor(){ this.x = Math.random() * canvas.width; this.y = Math.random() * canvas.height; this.size = Math.random() * 3 + 1; this.angle = Math.random() * Math.PI * 2; this.speed = Math.random() * 0.4 + 0.1; this.alpha = Math.random(); this.fadeSpeed = Math.random() * 0.02 + 0.005; this.colorBase = `255, 230, ${Math.floor(Math.random() * 100 + 150)}`; } update() { this.x += Math.cos(this.angle) * this.speed; this.y += Math.sin(this.angle) * this.speed; this.angle += Math.random() * 0.2 - 0.1; if(this.x<0)this.x=canvas.width; if(this.x>canvas.width)this.x=0; if(this.y<0)this.y=canvas.height; if(this.y>canvas.height)this.y=0; this.alpha+=this.fadeSpeed; if(this.alpha>1||this.alpha<0.2)this.fadeSpeed=-this.fadeSpeed; } draw() { ctx.save(); ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fillStyle = `rgba(${this.colorBase}, ${Math.abs(this.alpha)})`; ctx.fill(); ctx.shadowBlur = 15; ctx.shadowColor = `rgba(${this.colorBase}, 0.8)`; ctx.fill(); ctx.restore(); } }
            
            function initParticles(type) { particles = []; const count = window.innerWidth < 768 ? 25 : 60; for(let i=0; i<count; i++) { type === 'sakura' ? particles.push(new Sakura()) : particles.push(new Firefly()); } }
            function animate() { ctx.clearRect(0, 0, canvas.width, canvas.height); particles.forEach(p => { p.update(); p.draw(); }); animationId = requestAnimationFrame(animate); }
            
            const isDarkNow = body.classList.contains('night-mode');
            initParticles(isDarkNow ? 'firefly' : 'sakura');
            animate();

            if(btn) {
                btn.addEventListener("change", e => {
                    const isDarkMode = e.detail === 'dark';
                    localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
                    if (isDarkMode) { body.classList.add('night-mode'); cancelAnimationFrame(animationId); initParticles('firefly'); animate(); } 
                    else { body.classList.remove('night-mode'); cancelAnimationFrame(animationId); initParticles('sakura'); animate(); }
                });
            }
        }

        // === [核心修复] 筛选逻辑 ===
        function filterPosts(filterValue) {
            // 全部转小写，去除空格
            const target = filterValue ? filterValue.toLowerCase().trim() : 'all';
            let visibleCount = 0;
            
            posts.forEach(post => {
                const rawTags = post.getAttribute('data-tags') || "";
                const postTags = rawTags.split(',').map(t => t.trim().toLowerCase());
                
                if (target === 'all' || postTags.includes(target)) {
                    post.classList.remove('hidden');
                    
                    // [关键修复] 这里必须使用 cardIn，因为它对应 CSS 里的 @keyframes cardIn
                    // 之前写的是 fadeUp，但 CSS 里没有 fadeUp，所以 opacity 保持 0，导致透明
                    post.style.animation = 'none';
                    post.offsetHeight; /* trigger reflow */
                    post.style.animation = 'cardIn 0.6s ease-out forwards'; 
                    
                    visibleCount++;
                } else {
                    post.classList.add('hidden');
                }
            });

            if (visibleCount === 0) {
                noResultMsg.style.display = 'block';
            } else {
                noResultMsg.style.display = 'none';
            }
        }

        // 绑定按钮点击事件
        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                filterBtns.forEach(b => b.classList.remove('active')); 
                btn.classList.add('active');
                const val = btn.getAttribute('data-filter');
                filterPosts(val);
            });
        });

        // URL 参数自动筛选
        const urlParams = new URLSearchParams(window.location.search);
        const rawTagParam = urlParams.get('tag');
        if (rawTagParam) {
            const tagParam = decodeURIComponent(rawTagParam);
            // 尝试找到按钮 (手动遍历以避免 CSS.escape 兼容性问题)
            let targetBtn = null;
            for(let b of filterBtns) {
                if(b.getAttribute('data-filter') === tagParam) {
                    targetBtn = b;
                    break;
                }
            }
            
            if (targetBtn) {
                targetBtn.classList.add('active');
                const allBtn = document.querySelector('.filter-btn[data-filter="all"]');
                if(allBtn) allBtn.classList.remove('active');
            }
            filterPosts(tagParam);
            
            // 滚动定位
            const container = document.querySelector('.container');
            if(container) {
                setTimeout(() => { container.scrollIntoView({ behavior: 'smooth' }); }, 300);
            }
        }
    });

    // 移除 preload
    window.addEventListener('load', () => {
        setTimeout(() => {
            document.body.classList.remove('preload');
        }, 100);
    });
    </script>
</body>
</html>